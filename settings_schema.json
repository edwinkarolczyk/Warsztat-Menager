{
  "magazyn": {
    "type": "object",
    "title": "Magazyn",
    "properties": {
      "require_reauth": {
        "type": "boolean",
        "title": "Wymagaj re-autoryzacji przy PZ/WZ",
        "default": true
      },
      "rounding": {
        "type": "object",
        "title": "Zaokrąglanie",
        "properties": {
          "mb_precision": {
            "type": "integer",
            "title": "Precyzja dla 'mb'",
            "minimum": 0,
            "maximum": 6,
            "default": 3
          },
          "enforce_integer_for_szt": {
            "type": "boolean",
            "title": "Wymuszaj liczby całkowite dla 'szt'",
            "default": true
          }
        }
      },
      "round_quantities": { "type": "boolean", "default": true },
      "default_unit": {
        "type": "string",
        "default": "szt",
        "enum": ["szt", "mb"]
      },
      "dim_in_mm": { "type": "boolean", "default": true },
      "len_in_mb": { "type": "boolean", "default": true },
      "pz": {
        "type": "object",
        "properties": {
          "prefix": { "type": "string", "default": "PZ" },
          "width": {
            "type": "integer",
            "default": 5,
            "minimum": 1,
            "maximum": 10
          },
          "reset_daily": { "type": "boolean", "default": false },
          "seq_file": {
            "type": "string",
            "default": "data/magazyn/_seq_pz.json"
          }
        }
      },
      "auto_rezerwacje": { "type": "boolean", "default": true },
      "rezerwacje_only_started_orders": { "type": "boolean", "default": true },
      "rezerwacje_positive_only": { "type": "boolean", "default": true },
      "alert_procent": {
        "type": "integer",
        "default": 10,
        "minimum": 1,
        "maximum": 100
      },
      "low_stock_auto_order": { "type": "boolean", "default": true },
      "perms": {
        "type": "object",
        "properties": {
          "brygadzista": {
            "type": "object",
            "properties": {
              "edit": { "type": "boolean", "default": true },
              "pz": { "type": "boolean", "default": false }
            }
          },
          "magazynier": {
            "type": "object",
            "properties": {
              "edit": { "type": "boolean", "default": true },
              "pz": { "type": "boolean", "default": true }
            }
          }
        }
      }
    }
  },
  "orders": {
    "type": "object",
    "title": "Ustawienia zleceń",
    "properties": {
      "id_width": { "type": "integer", "default": 4, "minimum": 3, "maximum": 6 },
      "types": {
        "type": "object",
        "properties": {
          "ZW": {
            "type": "object",
            "properties": {
              "enabled": { "type": "boolean", "default": true },
              "label": { "type": "string", "default": "Zlecenie wewnętrzne" },
              "prefix": { "type": "string", "default": "ZW-" },
              "reserve_by_default": { "type": "boolean", "default": false },
              "allow_products": { "type": "boolean", "default": true },
              "bom_required": { "type": "boolean", "default": true },
              "statuses": {
                "type": "array",
                "items": { "type": "string" },
                "default": ["nowe","w trakcie","zakończone","anulowane"]
              }
            },
            "required": ["enabled", "label", "prefix", "statuses"]
          },
          "ZN": {
            "type": "object",
            "properties": {
              "enabled": { "type": "boolean", "default": true },
              "label": { "type": "string", "default": "Zlecenie na narzędzie" },
              "prefix": { "type": "string", "default": "ZN-" },
              "reserve_by_default": { "type": "boolean", "default": true },
              "allow_old_tools": { "type": "boolean", "default": true },
              "tools_range": {
                "type": "array",
                "items": { "type": "integer" },
                "default": [500,1000]
              },
              "statuses": {
                "type": "array",
                "items": { "type": "string" },
                "default": ["projekt","w budowie","ostrzenie","naprawa","odbiór","na produkcji","anulowane"]
              }
            },
            "required": ["enabled", "label", "prefix", "statuses"]
          },
          "ZM": {
            "type": "object",
            "properties": {
              "enabled": { "type": "boolean", "default": true },
              "label": { "type": "string", "default": "Naprawa/awaria maszyny" },
              "prefix": { "type": "string", "default": "ZM-" },
              "reserve_by_default": { "type": "boolean", "default": true },
              "require_description": { "type": "boolean", "default": true },
              "urgency_colors": {
                "type": "object",
                "default": {
                  "wysoki": "blink_red",
                  "normalny": "yellow",
                  "niski": "green"
                }
              },
              "statuses": {
                "type": "array",
                "items": { "type": "string" },
                "default": ["awaria zgłoszona","diagnoza","w naprawie","test","sprawdzona","zakończone","anulowane"]
              }
            },
            "required": ["enabled", "label", "prefix", "statuses"]
          }
        },
        "required": ["ZW", "ZN", "ZM"]
      }
    },
    "required": ["id_width", "types"]
  },
  "tabs": [
    {
      "id": "system",
      "title": "System",
      "icon": "settings",
      "description": "Ogólne ustawienia systemowe.",
      "groups": [
        {
          "title": "Wygląd i logowanie",
          "fields": []
        },
        {
          "title": "Ścieżki i start",
          "fields": [
            {
              "type": "text",
              "key": "system.data_path",
              "label": "Ścieżka danych",
              "default": "C:\\\\wm\\\\data",
              "placeholder": "np. C:\\\\wm\\\\data"
            },
            {
              "type": "boolean",
              "key": "system.start_on_dashboard",
              "label": "Startuj na panel główny",
              "default": true
            }
          ]
        }
      ]
    },
    {
      "id": "uzytkownicy",
      "title": "Użytkownicy",
      "icon": "users",
      "description": "Zarządzanie użytkownikami i rolami.",
      "subtabs": [
        {
          "id": "moj_profil",
          "title": "Mój profil",
          "description": "Podgląd danych zalogowanego użytkownika.",
          "groups": [
            {
              "title": "Informacje",
              "fields": [
                {
                  "type": "info",
                  "key": "profile.info",
                  "text": "Dane z bieżącej sesji. Edycje w 'Zarządzanie (lista)'."
                }
              ]
            }
          ]
        },
        {
          "id": "uprawnienia",
          "title": "Uprawnienia",
          "description": "Konfiguracja ról i dostępu.",
          "groups": [
            {
              "title": "Role i dostęp",
              "fields": []
            }
          ]
        },
        {
          "id": "zarzadzanie_lista",
          "title": "Zarządzanie (lista)",
          "description": "Lista użytkowników.",
          "groups": [
            {
              "title": "Lista kont",
              "fields": []
            }
          ]
        }
      ]
    },
    {
      "id": "maszyny",
      "title": "Maszyny",
      "icon": "layout",
      "description": "Ustawienia widoku i pracy z rozmieszczeniem maszyn.",
      "tooltip": "Siatka, tło, numeracja oraz zaznaczanie.",
      "groups": [
        {
          "title": "Widok i siatka",
          "fields": [
            {
              "type": "number",
              "key": "hall.grid_size_px",
              "label": "Rozmiar kratki (px)",
              "default": 4,
              "min": 1,
              "max": 20
            },
            {
              "type": "boolean",
              "key": "hall.snap_to_grid",
              "label": "Przyciągaj do siatki",
              "default": true
            },
            {
              "type": "text",
              "key": "hall.background_image",
              "label": "Tło (plik JPEG/PNG)",
              "placeholder": "np. C:\\\\wm\\\\data\\\\hala_bg.jpg"
            },
            {
              "type": "button",
              "key": "hall.background_image_pick",
              "label": "Wybierz z dysku…",
              "action": "dialog.open_file",
              "params": {
                "filters": ["*.png","*.jpg","*.jpeg"],
                "write_to_key": "hall.background_image"
              }
            },
            {
              "type": "select",
              "key": "hall.background_fit",
              "label": "Dopasowanie tła",
              "options": [
                {"label":"Dopasuj (contain)","value":"contain"},
                {"label":"Wypełnij (cover)","value":"cover"},
                {"label":"Rozciągnij","value":"stretch"},
                {"label":"Oryginalny rozmiar","value":"none"}
              ],
              "default": "contain"
            },
            {
              "type": "number",
              "key": "hall.background_opacity",
              "label": "Przezroczystość tła (%)",
              "default": 100,
              "min": 0,
              "max": 100
            },
            {
              "type": "boolean",
              "key": "hall.show_numbers",
              "label": "Pokaż numery hal na maszynach",
              "default": true
            }
          ]
        },
        {
          "title": "Zaznaczanie",
          "fields": [
            {
              "type": "boolean",
              "key": "hall.enable_selection",
              "label": "Włącz zaznaczanie obiektów",
              "default": true
            },
            {
              "type": "boolean",
              "key": "hall.multi_select",
              "label": "Zaznaczanie wielokrotne (Shift)",
              "default": true
            },
            {
              "type": "boolean",
              "key": "hall.lasso_select",
              "label": "Zaznaczanie obszarem (lasso)",
              "default": true
            }
          ]
        },
        {
          "title": "Pomieszczenia i ściany (ustawienia)",
          "fields": [
            {
              "type": "boolean",
              "key": "hall.rooms_enabled",
              "label": "Włącz warstwę pomieszczeń",
              "default": true
            },
            {
              "type": "number",
              "key": "hall.rooms_limit",
              "label": "Maks. liczba pomieszczeń",
              "default": 10,
              "min": 1,
              "max": 50
            },
            {
              "type": "array",
              "key": "hall.room_types",
              "label": "Typy pomieszczeń",
              "default": ["Biuro","Magazyn","Produkcja","Kontrola","Komunikacja"]
            },
            {
              "type": "number",
              "key": "hall.default_wall_thickness_mm",
              "label": "Domyślna grubość ściany (mm)",
              "default": 120,
              "min": 50,
              "max": 500
            }
          ]
        }
      ]
    },
    {
      "id": "narzedzia",
      "title": "Narzędzia",
      "icon": "wrench",
      "description": "Konfiguracja narzędzi.",
      "subtabs": [
        {
          "id": "typy_statusy",
          "title": "Typy i statusy",
          "groups": [
            {
              "title": "Typy narzędzi",
              "fields": [
                {
                  "type": "array",
                  "key": "tools.types",
                  "label": "Typy narzędzi",
                  "default": [
                    "Tłoczące",
                    "Wykrawające",
                    "Postępowe",
                    "Giętarka"
                  ]
                }
              ]
            },
            {
              "title": "Statusy narzędzi",
              "fields": [
                {
                  "type": "array",
                  "key": "tools.statuses",
                  "label": "Lista statusów",
                  "default": [
                    "awaria zgłoszona",
                    "diagnoza",
                    "w naprawie",
                    "test",
                    "sprawdzona",
                    "zakończone",
                    "anulowane"
                  ]
                }
              ]
            },
            {
              "title": "Szablony zadań",
              "fields": [
                {
                  "type": "array",
                  "key": "tools.task_templates",
                  "label": "Lista zadań",
                  "default": [
                    "Przegląd wizualny",
                    "Czyszczenie i smarowanie",
                    "Pomiar luzów",
                    "Wymiana elementu roboczego",
                    "Test na prasie"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "reguly",
          "title": "Reguły",
          "groups": [
            {
              "title": "Automatyczne odhaczanie",
              "fields": [
                {
                  "type": "array",
                  "key": "tools.auto_check_on_status",
                  "label": "Statusy oznaczające wykonane zadania",
                  "default": [
                    "sprawne",
                    "zakończone"
                  ]
                },
                {
                  "type": "boolean",
                  "key": "tools.auto_check_on_last_status",
                  "label": "Odhaczaj zadania przy ostatnim statusie",
                  "default": true
                },
                {
                  "type": "info",
                  "key": "tools.auto_check_hint",
                  "text": "Jeśli włączone: po ustawieniu ostatniego statusu z listy 'Statusy narzędzi' wszystkie zadania zostaną oznaczone jako wykonane."
                }
              ]
            },
            {
              "title": "Podgląd NN/SN",
              "fields": [
                {
                  "type": "number",
                  "key": "tools.nn_sn_preview_rows",
                  "label": "Podgląd – liczba wierszy",
                  "default": 2,
                  "min": 1,
                  "max": 6
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "zlecenia",
      "title": "Zlecenia",
      "icon": "clipboard",
      "description": "Ustawienia zleceń.",
      "subtabs": [
        {
          "id": "statusy",
          "title": "Statusy",
          "groups": [
            {
              "title": "Statusy zleceń",
              "fields": [
                {
                  "type": "array",
                  "key": "orders.statuses",
                  "label": "Lista statusów",
                  "default": [
                    "nowe",
                    "w toku",
                    "wstrzymane",
                    "do odbioru",
                    "zakończone",
                    "anulowane"
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "kreator",
          "title": "Kreator",
          "groups": [
            {
              "title": "Opcje kreatora",
              "fields": [
                {
                  "type": "boolean",
                  "key": "orders.wizard_dark",
                  "label": "Ciemny motyw",
                  "default": true
                },
                {
                  "type": "boolean",
                  "key": "orders.wizard_separate_window",
                  "label": "Osobne okno",
                  "default": true
                },
                {
                  "type": "array",
                  "key": "orders.required_fields",
                  "label": "Pola wymagane",
                  "default": [
                    "klient",
                    "opis",
                    "termin"
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "magazyn",
      "title": "Magazyn",
      "icon": "boxes",
      "description": "Parametry magazynu oraz BOM/produkty.",
      "tooltip": "Progi, katalogi, źródła stanów.",
      "subtabs": [
        {
          "id": "ustawienia_magazynu",
          "title": "Ustawienia magazynu",
          "groups": [
            {
              "title": "Parametry magazynu",
              "fields": [
                {
                  "type": "text",
                  "key": "warehouse.bom_dir",
                  "label": "Katalog BOM",
                  "default": "C:\\\\wm\\\\data\\\\produkty\\\\"
                },
                {
                  "type": "number",
                  "key": "warehouse.low_stock_threshold",
                  "label": "Próg alertu stanu (%)",
                  "default": 10,
                  "min": 0,
                  "max": 100
                },
                {
                  "type": "boolean",
                  "key": "warehouse.reserve_on_order",
                  "label": "Rezerwuj materiał przy zleceniu",
                  "default": true
                },
                {
                  "type": "text",
                  "key": "warehouse.stock_source",
                  "label": "Źródło stanów",
                  "default": "C:\\\\wm\\\\data\\\\magazyn.json"
                },
                {
                  "type": "number",
                  "key": "warehouse.target_stock_percent",
                  "label": "Stan docelowy (%)",
                  "default": 100,
                  "min": 10,
                  "max": 300
                }
              ]
            }
          ]
        },
        {
          "id": "produkty_bom",
          "title": "Produkty (BOM)",
          "groups": [
            {
              "title": "BOM",
              "fields": []
            }
          ]
        }
      ]
    },
    {
      "id": "zamowienia",
      "title": "Zamówienia",
      "icon": "shopping-cart",
      "description": "Parametry zamówień materiałów.",
      "groups": [
        {
          "title": "Parametry zamówień",
          "fields": [
            {
              "type": "boolean",
              "key": "orders.ask_to_order_shortage",
              "label": "Pytaj o zamówienie braków automatycznie",
              "default": true
            },
            {
              "type": "text",
              "key": "orders.default_supplier",
              "label": "Domyślny dostawca"
            },
            {
              "type": "text",
              "key": "orders.min_order_threshold",
              "label": "Próg minimalny (szt. lub %)",
              "placeholder": "np. 5 lub 10%"
            }
          ]
        }
      ]
    },
    {
      "id": "aktualizacje",
      "title": "Aktualizacje & Kopie",
      "icon": "refresh",
      "description": "Aktualizacja z repozytorium i kopie zapasowe.",
      "groups": [
        {
          "title": "Operacje",
          "fields": [
            {
              "type": "text",
              "key": "updates.branch_name",
              "label": "Gałąź do pobrania",
              "default": "Rozwiniecie"
            },
            {
              "type": "button",
              "key": "updates.btn_git_pull",
              "label": "Git Pull (domyślny)",
              "action": "updater.git_pull"
            },
            {
              "type": "button",
              "key": "updates.btn_pull_branch",
              "label": "Pobierz z gałęzi",
              "action": "updater.pull_branch",
              "params": { "branch_key": "updates.branch_name" }
            },
            {
              "type": "button",
              "key": "updates.btn_backup_zip",
              "label": "Wykonaj kopię ZIP",
              "action": "updater.backup_zip"
            },
            {
              "type": "button",
              "key": "updates.btn_restore",
              "label": "Przywróć z pliku…",
              "action": "updater.restore_dialog"
            }
          ]
        }
      ]
    },
    {
      "id": "tests",
      "title": "Testy",
      "icon": "beaker",
      "description": "Panel testowy (tylko DEV).",
      "devOnly": true,
      "groups": []
    }
  ]
}
